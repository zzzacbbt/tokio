<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `RefCnt` trait in crate `arc_swap`."><meta name="keywords" content="rust, rustlang, rust-lang, RefCnt"><title>arc_swap::RefCnt - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script></head><body class="rustdoc trait"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><p class='location'>Trait RefCnt</p><div class="sidebar-elems"><div class="block items"><a class="sidebar-title" href="#associated-types">Associated Types</a><div class="sidebar-links"><a href="#associatedtype.Base">Base</a></div><a class="sidebar-title" href="#required-methods">Required Methods</a><div class="sidebar-links"><a href="#tymethod.into_ptr">into_ptr</a><a href="#tymethod.as_ptr">as_ptr</a><a href="#tymethod.from_ptr">from_ptr</a><a href="#tymethod.can_null">can_null</a></div><a class="sidebar-title" href="#provided-methods">Provided Methods</a><div class="sidebar-links"><a href="#method.inc">inc</a><a href="#method.dec">dec</a></div><a class="sidebar-title" href="#foreign-impls">Implementations on Foreign Types</a><div class="sidebar-links"><a href="#impl-RefCnt">Arc&lt;T&gt;</a><a href="#impl-RefCnt">Option&lt;T&gt;</a></div><a class="sidebar-title" href="#implementors">Implementors</a></div><p class='location'><a href='index.html'>arc_swap</a></p><script>window.sidebarCurrent = {name: 'RefCnt', ty: 'trait', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#27-73' title='goto source code'>[src]</a></span><span class='in-band'>Trait <a href='index.html'>arc_swap</a>::<wbr><a class="trait" href=''>RefCnt</a></span></h1><div class="docblock type-decl hidden-by-usual-hider"><pre class='rust trait'>pub unsafe trait RefCnt: <a class="trait" href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html" title="trait core::clone::Clone">Clone</a> {
    type <a href='#associatedtype.Base' class="type">Base</a>;
    fn <a href='#tymethod.into_ptr' class='fnname'>into_ptr</a>(me: Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>;
<div class='item-spacer'></div>    fn <a href='#tymethod.as_ptr' class='fnname'>as_ptr</a>(me: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>;
<div class='item-spacer'></div>    unsafe fn <a href='#tymethod.from_ptr' class='fnname'>from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) -&gt; Self;
<div class='item-spacer'></div>    fn <a href='#tymethod.can_null' class='fnname'>can_null</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>;

    fn <a href='#method.inc' class='fnname'>inc</a>(me: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>Self) { ... }
<div class='item-spacer'></div>    unsafe fn <a href='#method.dec' class='fnname'>dec</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) { ... }
}</pre></div><div class='docblock'><p>A trait describing smart reference counted pointers.</p>
<p>Note that in a form <code>Option&lt;Arc&lt;T&gt;&gt;</code> is also a smart reference counted pointer, just one that
can hold NULL.</p>
<p>The trait is unsafe, because a wrong implementation will break the
<a href="struct.ArcSwapAny.html"><code>ArcSwapAny</code></a> implementation and lead to UB.</p>
<p>This is not actually expected for downstream crate to implement, this is just means to reuse
code for <code>Arc</code> and <code>Option&lt;Arc&gt;</code> variants. However, it is theoretically possible (if you have
your own <code>Arc</code> implementation).</p>
<p>Implementing it for <code>Rc</code> is possible, but not useful (because the <code>ArcSwap</code> then would not be
<code>Send</code> nor <code>Sync</code>, so there's very little advantage of using it if it can't be shared between
threads).</p>
<p>Aside from the obvious properties (like that incrementing and decrementing a reference count
cancel each out and that having less references tracked than how many things actually point to
the value is fine as long as the count doesn't drop to 0), it also must satisfy that if two
pointers have the same value, they point to the same object. This is specifically not true for
ZSTs, but it is true for <code>Arc</code>s of ZSTs, because they have the reference counts just after the
value. It would be fine to point to a type-erased version of the same object, though (if one
could use this trait with unsized types in the first place).</p>
</div>
            <h2 id='associated-types' class='small-section-header'>
              Associated Types<a href='#associated-types' class='anchor'></a>
            </h2>
            <div class='methods'>
        <h3 id='associatedtype.Base' class='method'><span id='Base.t' class='invisible'><code>type <a href='#associatedtype.Base' class="type">Base</a></code></span></h3><div class='docblock'><p>The base type the pointer points to.</p>
</div></div>
            <h2 id='required-methods' class='small-section-header'>
              Required Methods<a href='#required-methods' class='anchor'></a>
            </h2>
            <div class='methods'>
        <h3 id='tymethod.into_ptr' class='method'><span id='into_ptr.v' class='invisible'><code>fn <a href='#tymethod.into_ptr' class='fnname'>into_ptr</a>(me: Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></code></span></h3><div class='docblock'><p>Converts the smart pointer into a raw pointer, without affecting the reference count.</p>
<p>This can be seen as kind of freezing the pointer ‒ it'll be later converted back using
<a href="#method.from_ptr"><code>from_ptr</code></a>.</p>
<p>The pointer must point to the value stored (and the value must be the same as one returned
by <a href="#method.as_ptr"><code>as_ptr</code></a>.</p>
</div><h3 id='tymethod.as_ptr' class='method'><span id='as_ptr.v' class='invisible'><code>fn <a href='#tymethod.as_ptr' class='fnname'>as_ptr</a>(me: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></code></span></h3><div class='docblock'><p>Provides a view into the smart pointer as a raw pointer.</p>
<p>This must not affect the reference count ‒ the pointer is only borrowed.</p>
</div><h3 id='tymethod.from_ptr' class='method'><span id='from_ptr.v' class='invisible'><code>unsafe fn <a href='#tymethod.from_ptr' class='fnname'>from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) -&gt; Self</code></span></h3><div class='docblock'><p>Converts a raw pointer back into the smart pointer, without affecting the reference count.</p>
<p>This is only called on values previously returned by <a href="#method.into_ptr"><code>into_ptr</code></a>.
However, it is not guaranteed to be 1:1 relation ‒ <code>from_ptr</code> may be called more times than
<code>into_ptr</code> temporarily provided the reference count never drops under 1 during that time
(the implementation sometimes owes a reference).</p>
</div><h3 id='tymethod.can_null' class='method'><span id='can_null.v' class='invisible'><code>fn <a href='#tymethod.can_null' class='fnname'>can_null</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a></code></span></h3><div class='docblock'><p>Describes if the raw pointer can ever be null.</p>
<p>Things like <code>Arc</code> are never null and can safely return false here. This is used only for
better formatting ‒ lying here won't cause an UB, but can cause uglier debug output or
panic inside debug formatting.</p>
</div></div>
            <h2 id='provided-methods' class='small-section-header'>
              Provided Methods<a href='#provided-methods' class='anchor'></a>
            </h2>
            <div class='methods'>
        <h3 id='method.inc' class='method'><span id='inc.v' class='invisible'><code>fn <a href='#method.inc' class='fnname'>inc</a>(me: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>Self)</code></span></h3><div class='docblock'><p>Increments the reference count by one.</p>
</div><h3 id='method.dec' class='method'><span id='dec.v' class='invisible'><code>unsafe fn <a href='#method.dec' class='fnname'>dec</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>)</code></span></h3><div class='docblock'><p>Decrements the reference count by one.</p>
<p>Note this is called on a raw pointer (one previously returned by
<a href="#method.into_ptr"><code>into_ptr</code></a>. This may lead to dropping of the reference count to 0 and
destruction of the internal pointer.</p>
</div></div>
                <h2 id='foreign-impls' class='small-section-header'>
                  Implementations on Foreign Types<a href='#foreign-impls' class='anchor'></a>
                </h2>
            <h3 id='impl-RefCnt' class='impl'><span class='in-band'><table class='table-display'><tbody><tr><td><code>impl&lt;T&gt; <a class="trait" href="../arc_swap/trait.RefCnt.html" title="trait arc_swap::RefCnt">RefCnt</a> for <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;</code><a href='#impl-RefCnt' class='anchor'></a></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#78-92' title='goto source code'>[src]</a></span></td></tr></tbody></table></h3><div class='impl-items'><h4 id='associatedtype.Base-1' class="type"><span id='Base.t-1' class='invisible'><code>type <a href='#associatedtype.Base' class="type">Base</a> = T</code></span></h4>
<h4 id='method.into_ptr' class="method hidden"><span id='into_ptr.v-1' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='#method.into_ptr' class='fnname'>into_ptr</a>(me: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut T</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#80-82' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.as_ptr' class="method hidden"><span id='as_ptr.v-1' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='#method.as_ptr' class='fnname'>as_ptr</a>(me: &amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut T</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#83-85' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.from_ptr' class="method hidden"><span id='from_ptr.v-1' class='invisible'><table class='table-display'><tbody><tr><td><code>unsafe fn <a href='#method.from_ptr' class='fnname'>from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const T</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#86-88' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.can_null' class="method hidden"><span id='can_null.v-1' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='#method.can_null' class='fnname'>can_null</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#89-91' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.inc-1' class="method"><span id='inc.v-1' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='../arc_swap/trait.RefCnt.html#method.inc' class='fnname'>inc</a>(me: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>Self)</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#54-56' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.dec-1' class="method"><span id='dec.v-1' class='invisible'><table class='table-display'><tbody><tr><td><code>unsafe fn <a href='../arc_swap/trait.RefCnt.html#method.dec' class='fnname'>dec</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>)</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#63-65' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4></div><h3 id='impl-RefCnt-1' class='impl'><span class='in-band'><table class='table-display'><tbody><tr><td><code>impl&lt;T:&nbsp;<a class="trait" href="../arc_swap/trait.NonNull.html" title="trait arc_swap::NonNull">NonNull</a>&gt; <a class="trait" href="../arc_swap/trait.RefCnt.html" title="trait arc_swap::RefCnt">RefCnt</a> for <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;</code><a href='#impl-RefCnt-1' class='anchor'></a></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#94-112' title='goto source code'>[src]</a></span></td></tr></tbody></table></h3><div class='impl-items'><h4 id='associatedtype.Base-2' class="type"><span id='Base.t-2' class='invisible'><code>type <a href='#associatedtype.Base' class="type">Base</a> = T::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></code></span></h4>
<h4 id='method.into_ptr-1' class="method hidden"><span id='into_ptr.v-2' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='#method.into_ptr' class='fnname'>into_ptr</a>(me: <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a>T::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#96-98' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.as_ptr-1' class="method hidden"><span id='as_ptr.v-2' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='#method.as_ptr' class='fnname'>as_ptr</a>(me: &amp;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a>T::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#99-101' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.from_ptr-1' class="method hidden"><span id='from_ptr.v-2' class='invisible'><table class='table-display'><tbody><tr><td><code>unsafe fn <a href='#method.from_ptr' class='fnname'>from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const </a>T::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#102-108' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.can_null-1' class="method hidden"><span id='can_null.v-2' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='#method.can_null' class='fnname'>can_null</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#109-111' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.inc-2' class="method"><span id='inc.v-2' class='invisible'><table class='table-display'><tbody><tr><td><code>fn <a href='../arc_swap/trait.RefCnt.html#method.inc' class='fnname'>inc</a>(me: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>Self)</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#54-56' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><h4 id='method.dec-2' class="method"><span id='dec.v-2' class='invisible'><table class='table-display'><tbody><tr><td><code>unsafe fn <a href='../arc_swap/trait.RefCnt.html#method.dec' class='fnname'>dec</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*const </a>Self::<a class="type" href="../arc_swap/trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>)</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/arc_swap/ref_cnt.rs.html#63-65' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4></div><h2 id='implementors' class='small-section-header'>Implementors<a href='#implementors' class='anchor'></a></h2><div class='item-list' id='implementors-list'></div><script type="text/javascript">window.inlined_types=new Set([]);</script><script type="text/javascript" async
                         src="../implementors/arc_swap/trait.RefCnt.js">
                 </script></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g. <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g. <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g. <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../";window.currentCrate = "arc_swap";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>